%h1 Prescription
%p#notice= notice
%p
  %strong Date prescribed:
  = @prescription.date_prescribed
-doctor = Doctor.find(@prescription.doctor_id)
%p
  %strong Doctor:
  = doctor.descriptive_name
%p
  %strong Specialization:
  = doctor.specialization
%p
  %strong Clinic:
  = doctor.clinic_name
%p
  = doctor.clinic_address
%table
  %thead
    %tr
      %th Generic name
      %th Brand name
      %th Quantity
      %th Unit Price
      %th Amount
      %th{:colspan => "3"}
  %tbody
    - @prescribed_medicines.each do |prescribed_medicine|
      - medicine = Medicine.find(prescribed_medicine.medicine_id)
      %tr
        %td= medicine.generic_name.titleize
        %td= medicine.brand_name.titleize
        %td= prescribed_medicine.quantity
        %td= number_to_currency(medicine.cost, unit: "₱ ", separator: ".", delimiter: ",")
        %td= number_to_currency((prescribed_medicine.total_amount), unit: "₱ ", separator: ".", delimiter: ",")

%h4 Total Items
%p= PrescribedMedicine.where(prescription_id: @prescription.id).sum(:quantity)
%h4 Total Price
- total_price = Medicine.joins(:prescribed_medicines).where("prescribed_medicines.prescription_id" => @prescription.id).sum("medicines.cost * prescribed_medicines.quantity") 
%p= number_to_currency(total_price, unit: "₱ ", separator: ".", delimiter: ",")


= link_to 'New Prescription', new_prescription_path
= link_to 'Edit', edit_prescription_path(@prescription)
= link_to 'Back', prescriptions_path
